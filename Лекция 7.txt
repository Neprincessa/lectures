Лекция 7. 
Расследования инцидентов 2018-2019.
Сергей Голованов, Лаборатория Касперского
Sergey @k1k_Golovanov

DFIR+REMA
Digital forensics - судебная криминалистика



Основные проблемы:
Пионеры:
1. котлеты
2. winPot
3. koffey maker. Атака Blackbox (тестирование программы без возможности просмотра исходного кода).
	Внутрь банкомата помещается ноутбук для тестирования kodiak (для тестирования оборудования) и team viewer
	KDIAG подключается к диспенсеру

Silence.
	программы для атаки банков. 
	Минус: массовая, но не эффективно. потому что малый процент пробива
	особенность: маленькое количество операторов (после атаки начинают изучать)
	проблема получения полезной нагрузки

Карбанак:
	массова и эффективна.
	неограниченное число операторов
	новые рассылки и способы передачи
	проблемы получения полезной нагрузки

	у карбанака нет проблем с другими языками.
	Затирание, отключения логирования

	Антивирус: удаление записи в реестре, копируют его в удаленный, запускают и сразу же удаляют его. 
	?? - это кодировка base64

(почитать про firewall, pipe)

DarkVishnya
	Непонятно, откуда началась атака.
	В логах, firewall - ах, vpn видно зараженные пк, видно подключенный ip, отсутствующего на карте. Можно по таблице маршрутизации, постоянно сканировать, wifi eds, смотреть таблицу маршрутизации, http, возможно сохранился mac адрес, соответственно порт, затем кабель.
	1)Суть: подброшенные устройства.
	То есть злоумышленники не подключались к инету, выходило только устройство
	2) нет активной полезной нагрузки
	3) нет серверов управления вредоносными программами
	4) есть физический адрес
	5) специфические номера портов

	Можно отсматривать память. 
	Атака связана с карбанаками. Почему? 

	Устройства: raspberry pi, bash bunny (самые вредные, можно запустить код который там уже прописан), laptop



открытие портов на виндоус: 
отослать ОС в ресет: netsh trace start keyword=$2cREt захват инфы, когда приходит какой - то секрет.
как только находится открытый порт, то начинает работать программа злоумышленника.

Если атака даже и не прошла успешно, то можно использовать зараженные сервера для вытаскивания информации.

http log parsers 
1) java приложение
2) пробив базы
dwort - что это? 
sort | cut | uniq | tail -  для прохождения по логам прокси
tail - в файле читает
cut  - только часть  (посмотреть какую)
uniq - только уникальные 

elastic -бд позволяет считать вхождения строк
по логам можно увидеть, кто выкачивает бд

Карта сети
на карте сети указаны точки выхода в инет
доступ к kvm  из облака
к серверам был доступ извне, а пароль для kvm в браузере, браузер утек. mount.iso - образ позволял скопировать все 

Waterhall atack
если сломать сайт и подложить свой код

FLS - набор для форензики - выведет все имена, которые хранятся на жестком диске. Можно посмотреть кеши браузеров, и любые другие  за много лет
script fit (?) уточнить, acronys, paragon (сканируют таблицу mbr  на наличие файлов???)

sniffkit 


на диске с FLS + Browser's cache

необходимо дял того, чтобы установить, где был пользователь, когда получил вирус, т.е. когда произошла payload  атака.


3. Основные методы работы
Не затирать следы. Все действия дб проверяемы

cd /var/log -  логи  linux
mft master file table -  находится в начале диске, где инфа о всех файлах

cat -  вывод файла

в компаниях мб:
	1) удаленный доступ только через usb токены
	2) удаленный доступ в сети локального офиса
	3) администратор локального домаена не входит в группу локальных администарторов
	4) пароль админа в сейфе
Как получить удаленный доступ к пк бухгалтера?
	учетная запись акрониса (системы резервного копирования с правами лок - го доступа), соответственно usb токе получен
	приходит учетная запись backup

как справиться со злоумышленником:
1) УДАЛЕННЫЙ достпу через удвленного помощника (то же самое по сути)
2) глобальный администратор домена можт создавать пользователья в группе локалоьных администраторов
3) пароль можно ввести физически
затем fls

Не перепрыгивать через логи! 

shred - linux 
sdelete - windows -  безопасное удаление файлов с диска окончательно

Закладки в жесткий диск - ? 